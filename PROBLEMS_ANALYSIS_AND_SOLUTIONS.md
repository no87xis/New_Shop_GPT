# üö® –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú –ò –†–ï–®–ï–ù–ò–Ø
## –ü–æ—á–µ–º—É —Å–∏—Å—Ç–µ–º–∞ –ø–∞–¥–∞–µ—Ç –∏ –∫–∞–∫ —ç—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å

---

## üìä –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú –í –ü–†–û–ï–ö–¢–ï

### **1. –ü–†–û–ë–õ–ï–ú–ê: –°–µ—Ä–≤–µ—Ä –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–∞–¥–∞–µ—Ç**

#### **–ü—Ä–∏—á–∏–Ω—ã:**
- ‚ùå –°–ª–æ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- ‚ùå –ò–º–ø–æ—Ä—Ç—ã –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π
- ‚ùå –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤

#### **–°–∏–º–ø—Ç–æ–º—ã:**
```
ERROR: Traceback (most recent call last):
  File "uvicorn/server.py", line 78, in serve
    await self.startup(sockets=sockets)
asyncio.exceptions.CancelledError
```

#### **–†–µ—à–µ–Ω–∏—è:**
- ‚úÖ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é —Ä–∞–±–æ—á—É—é –≤–µ—Ä—Å–∏—é (`main_working.py`)
- ‚úÖ –£–±—Ä–∞—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å try-catch –¥–ª—è –≤—Å–µ—Ö –∏–º–ø–æ—Ä—Ç–æ–≤

---

### **2. –ü–†–û–ë–õ–ï–ú–ê: –û—à–∏–±–∫–∏ –≤ —à–∞–±–ª–æ–Ω–∞—Ö Jinja2**

#### **–ü—Ä–∏—á–∏–Ω—ã:**
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤ —à–∞–±–ª–æ–Ω–∞—Ö
- ‚ùå –ü–µ—Ä–µ–¥–∞—á–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∞—Ç—Ä–∏–±—É—Ç–∞–º
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤

#### **–°–∏–º–ø—Ç–æ–º—ã:**
```
TypeError: 'builtin_function_or_method' object is not iterable
TypeError: object of type 'builtin_function_or_method' has no len()
```

#### **–†–µ—à–µ–Ω–∏—è:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –≤ —à–∞–±–ª–æ–Ω—ã
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Jinja2
- ‚úÖ –î–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã –æ—Ç–¥–µ–ª—å–Ω–æ

---

### **3. –ü–†–û–ë–õ–ï–ú–ê: –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏ –º–æ–¥—É–ª–µ–π**

#### **–ü—Ä–∏—á–∏–Ω—ã:**
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã `__init__.py`
- ‚ùå –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∏–º–ø–æ—Ä—Ç–∞
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

#### **–°–∏–º–ø—Ç–æ–º—ã:**
```
ModuleNotFoundError: No module named 'app.routers.delivery_payment'
ImportError: cannot import name 'DeliveryNotificationService'
```

#### **–†–µ—à–µ–Ω–∏—è:**
- ‚úÖ –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ `__init__.py` —Ñ–∞–π–ª—ã
- ‚úÖ –£–±—Ä–∞—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

---

### **4. –ü–†–û–ë–õ–ï–ú–ê: –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö**

#### **–ü—Ä–∏—á–∏–Ω—ã:**
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
- ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### **–°–∏–º–ø—Ç–æ–º—ã:**
```
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed
sqlalchemy.exc.OperationalError: database is locked
```

#### **–†–µ—à–µ–Ω–∏—è:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ Foreign Key
- ‚úÖ –î–æ–±–∞–≤–ª—è—Ç—å –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª–µ–π
- ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å connection pooling

---

### **5. –ü–†–û–ë–õ–ï–ú–ê: –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Å—Å–∏—è–º–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π**

#### **–ü—Ä–∏—á–∏–Ω—ã:**
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Å—Å–∏–π
- ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å middleware
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å cookies

#### **–°–∏–º–ø—Ç–æ–º—ã:**
```
AttributeError: 'Request' object has no attribute 'session'
TypeError: 'NoneType' object is not callable
```

#### **–†–µ—à–µ–Ω–∏—è:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å SessionMiddleware
- ‚úÖ –î–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å try-catch –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Å—Å–∏—è–º–∏
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –æ—Ç–¥–µ–ª—å–Ω–æ

---

## üõ†Ô∏è –ö–û–ù–ö–†–ï–¢–ù–´–ï –†–ï–®–ï–ù–ò–Ø –î–õ–Ø –ù–ê–®–ò–• –ü–†–û–ë–õ–ï–ú

### **–†–µ—à–µ–Ω–∏–µ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏**

#### **–ü—Ä–æ–±–ª–µ–º–∞:**
–°–µ—Ä–≤–µ—Ä –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ —Å–ª–æ–∂–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

#### **–†–µ—à–µ–Ω–∏–µ:**
```python
# app/main_stable.py - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
from fastapi import FastAPI, Request, Depends
from fastapi.staticfiles import StaticFiles
from fastapi.templating import Jinja2Templates
from starlette.middleware.sessions import SessionMiddleware
from sqlalchemy.orm import Session
from .config import settings
from .db import engine, Base, get_db

# –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ —Ä–æ—É—Ç–µ—Ä—ã
from .routers import web_public, web_products, web_orders, web_shop, shop_api

# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
app = FastAPI(title="Sirius - Stable Version")

# Middleware —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
try:
    app.add_middleware(
        SessionMiddleware,
        secret_key=settings.secret_key,
        max_age=settings.session_max_age,
        same_site="lax",
        https_only=False
    )
except Exception as e:
    print(f"Warning: Session middleware error: {e}")

# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
try:
    app.mount("/static", StaticFiles(directory="app/static"), name="static")
except Exception as e:
    print(f"Warning: Static files error: {e}")

# Templates
templates = Jinja2Templates(directory="app/templates")

# –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã
try:
    app.include_router(web_public.router)
    app.include_router(web_products.router)
    app.include_router(web_orders.router)
    app.include_router(web_shop.router)
    app.include_router(shop_api.router)
except Exception as e:
    print(f"Warning: Router error: {e}")

# –ë–∞–∑–æ–≤—ã–µ —Ä–æ—É—Ç—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
@app.get("/")
async def root(request: Request, db: Session = Depends(get_db)):
    try:
        return templates.TemplateResponse("index.html", {"request": request})
    except Exception as e:
        return {"error": f"Template error: {e}"}

@app.get("/health")
async def health_check():
    return {"status": "ok", "version": "stable"}

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
try:
    Base.metadata.create_all(bind=engine)
except Exception as e:
    print(f"Warning: Database error: {e}")
```

### **–†–µ—à–µ–Ω–∏–µ 2: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —à–∞–±–ª–æ–Ω–∞–º–∏**

#### **–ü—Ä–æ–±–ª–µ–º–∞:**
–û—à–∏–±–∫–∏ –≤ —à–∞–±–ª–æ–Ω–∞—Ö Jinja2

#### **–†–µ—à–µ–Ω–∏–µ:**
```python
# –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —à–∞–±–ª–æ–Ω—ã
def safe_template_data(cart_data):
    """–ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —à–∞–±–ª–æ–Ω–∞"""
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ cart_data —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if not cart_data:
            return {"items": [], "total_items": 0, "total_amount": 0.0}
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º items
        items = cart_data.get('items', [])
        if not isinstance(items, list):
            items = []
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –ø–æ–∑–∏—Ü–∏—é
        safe_items = []
        for item in items:
            if isinstance(item, dict):
                safe_item = {
                    'product_id': item.get('product_id', 0),
                    'product_name': item.get('product_name', 'Unknown'),
                    'quantity': item.get('quantity', 0),
                    'unit_price_rub': float(item.get('unit_price_rub', 0)),
                    'total_price': float(item.get('total_price', 0))
                }
                safe_items.append(safe_item)
        
        return {
            "items": safe_items,
            "total_items": len(safe_items),
            "total_amount": sum(item['total_price'] for item in safe_items)
        }
    except Exception as e:
        print(f"Template data error: {e}")
        return {"items": [], "total_items": 0, "total_amount": 0.0}

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ä–æ—É—Ç–µ—Ä–µ
@router.get("/cart", response_class=HTMLResponse)
async def shop_cart(request: Request, db: Session = Depends(get_db)):
    try:
        session_id = get_session_id(request)
        cart_summary = ShopCartService.get_cart_summary(db, session_id)
        
        # –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        cart_dict = safe_template_data(cart_summary)
        
        return templates.TemplateResponse("shop/cart.html", {
            "request": request,
            "cart": cart_dict
        })
    except Exception as e:
        return templates.TemplateResponse("error.html", {
            "request": request,
            "error": f"Cart error: {e}"
        })
```

### **–†–µ—à–µ–Ω–∏–µ 3: –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã**

#### **–ü—Ä–æ–±–ª–µ–º–∞:**
–û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π

#### **–†–µ—à–µ–Ω–∏–µ:**
```python
# app/routers/__init__.py - –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
import sys
from typing import Dict, Any

# –°–ª–æ–≤–∞—Ä—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ —Ä–æ—É—Ç–µ—Ä–æ–≤
ROUTERS = {}

def safe_import_router(name: str, module_path: str) -> Any:
    """–ë–µ–∑–æ–ø–∞—Å–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ä–æ—É—Ç–µ—Ä"""
    try:
        module = __import__(module_path, fromlist=[name])
        router = getattr(module, name)
        ROUTERS[name] = router
        return router
    except Exception as e:
        print(f"Warning: Failed to import {name}: {e}")
        return None

# –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏–º–ø–æ—Ä—Ç –≤—Å–µ—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤
safe_import_router('web_public', 'app.routers.web_public')
safe_import_router('web_products', 'app.routers.web_products')
safe_import_router('web_orders', 'app.routers.web_orders')
safe_import_router('web_shop', 'app.routers.web_shop')
safe_import_router('shop_api', 'app.routers.shop_api')

# –¢–æ–ª—å–∫–æ —Ä–∞–±–æ—á–∏–µ —Ä–æ—É—Ç–µ—Ä—ã
__all__ = [name for name, router in ROUTERS.items() if router is not None]

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–æ—É—Ç–µ—Ä–∞
def get_router(name: str):
    return ROUTERS.get(name)
```

### **–†–µ—à–µ–Ω–∏–µ 4: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**

#### **–ü—Ä–æ–±–ª–µ–º–∞:**
–°–ª–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å —Å–∏—Å—Ç–µ–º–æ–π

#### **–†–µ—à–µ–Ω–∏–µ:**
```python
# app/monitoring.py - —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
import logging
import traceback
from datetime import datetime
from typing import Dict, Any

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('logs/app.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)

class SystemMonitor:
    """–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã"""
    
    def __init__(self):
        self.errors = []
        self.warnings = []
        self.status = "unknown"
    
    def log_error(self, error: Exception, context: str = ""):
        """–õ–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É"""
        error_info = {
            "timestamp": datetime.now().isoformat(),
            "error": str(error),
            "context": context,
            "traceback": traceback.format_exc()
        }
        self.errors.append(error_info)
        logger.error(f"Error in {context}: {error}")
    
    def log_warning(self, message: str, context: str = ""):
        """–õ–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"""
        warning_info = {
            "timestamp": datetime.now().isoformat(),
            "message": message,
            "context": context
        }
        self.warnings.append(warning_info)
        logger.warning(f"Warning in {context}: {message}")
    
    def check_system_health(self) -> Dict[str, Any]:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã"""
        health = {
            "status": "healthy",
            "errors_count": len(self.errors),
            "warnings_count": len(self.warnings),
            "last_error": self.errors[-1] if self.errors else None,
            "timestamp": datetime.now().isoformat()
        }
        
        if len(self.errors) > 10:
            health["status"] = "critical"
        elif len(self.errors) > 5:
            health["status"] = "warning"
        
        return health

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä
monitor = SystemMonitor()

# –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ñ—É–Ω–∫—Ü–∏–π
def monitor_function(func):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ñ—É–Ω–∫—Ü–∏–π"""
    def wrapper(*args, **kwargs):
        try:
            result = func(*args, **kwargs)
            return result
        except Exception as e:
            monitor.log_error(e, f"{func.__name__}")
            raise
    return wrapper
```

---

## üîß –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### **1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏**

```
app/
‚îú‚îÄ‚îÄ main_stable.py          # –°—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
‚îú‚îÄ‚îÄ main_working.py         # –†–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è
‚îú‚îÄ‚îÄ main_experimental.py    # –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ settings.py
‚îÇ   ‚îî‚îÄ‚îÄ database.py
‚îú‚îÄ‚îÄ core/                   # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ exceptions.py
‚îÇ   ‚îú‚îÄ‚îÄ monitoring.py
‚îÇ   ‚îî‚îÄ‚îÄ utils.py
‚îú‚îÄ‚îÄ routers/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ base.py            # –ë–∞–∑–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ [–¥—Ä—É–≥–∏–µ —Ä–æ—É—Ç–µ—Ä—ã]
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ base_service.py    # –ë–∞–∑–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îî‚îÄ‚îÄ [–¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã]
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ test_basic.py
    ‚îî‚îÄ‚îÄ test_integration.py
```

### **2. –ü—Ä–æ—Ü–µ–¥—É—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

```bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
# test_system.bat

@echo off
echo Starting system test...

echo 1. Checking Python syntax...
python -c "import ast; ast.parse(open('app/main_working.py').read()); print('Syntax OK')"
if %errorlevel% neq 0 (
    echo ERROR: Syntax check failed
    exit /b 1
)

echo 2. Checking imports...
python -c "from app.main_working import app; print('Imports OK')"
if %errorlevel% neq 0 (
    echo ERROR: Import check failed
    exit /b 1
)

echo 3. Starting server...
start /b python -m uvicorn app.main_working:app --host 127.0.0.1 --port 8000

echo 4. Waiting for server...
timeout /t 5 /nobreak > nul

echo 5. Testing endpoints...
curl -s http://127.0.0.1:8000/health
if %errorlevel% neq 0 (
    echo ERROR: Health check failed
    exit /b 1
)

echo 6. Testing main page...
curl -s http://127.0.0.1:8000/
if %errorlevel% neq 0 (
    echo ERROR: Main page failed
    exit /b 1
)

echo 7. Testing shop...
curl -s http://127.0.0.1:8000/shop/
if %errorlevel% neq 0 (
    echo ERROR: Shop page failed
    exit /b 1
)

echo All tests passed!
```

### **3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π**

```python
# backup_system.py
import shutil
import datetime
import os

def create_backup(file_path: str) -> str:
    """–°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Ñ–∞–π–ª–∞"""
    timestamp = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
    backup_path = f"{file_path}.backup_{timestamp}"
    shutil.copy2(file_path, backup_path)
    return backup_path

def restore_backup(file_path: str, backup_path: str):
    """–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–∞–π–ª –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏"""
    shutil.copy2(backup_path, file_path)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
backup_path = create_backup("app/main_working.py")
# ... –≤–Ω–æ—Å–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è ...
# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:
# restore_backup("app/main_working.py", backup_path)
```

---

## üìã –ß–ï–ö–õ–ò–°–¢ –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–Ø –ü–†–û–ë–õ–ï–ú

### **–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã:**
- [ ] –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–ª–∞–Ω –∏–∑–º–µ–Ω–µ–Ω–∏–π

### **–í–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:**
- [ ] –î–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –ø—Ä–∞–≤–∫—É –∑–∞ —Ä–∞–∑
- [ ] –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –ø—Ä–∞–≤–∫–∏
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### **–ü–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã:**
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–ª–∞–Ω –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å

### **–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:**
- [ ] –ù–ï –ü–ê–ù–ò–ö–û–í–ê–¢–¨
- [ ] –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
- [ ] –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

## üéØ –ò–¢–û–ì–û–í–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### **1. –ü—Ä–∏–Ω—Ü–∏–ø "–ù–µ —Å–ª–æ–º–∞–π —Ç–æ, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç"**
- –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç - –Ω–µ —Ç—Ä–æ–≥–∞–π—Ç–µ –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–ø–∏–∏, –ø–æ—Ç–æ–º –≤–Ω–æ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ

### **2. –ü—Ä–∏–Ω—Ü–∏–ø "–û–¥–Ω–∞ –∑–∞–¥–∞—á–∞ - –æ–¥–Ω–∞ –ø—Ä–∞–≤–∫–∞"**
- –ù–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ —Å—Ä–∞–∑—É
- –î–µ–ª–∞–π—Ç–µ –º–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞

### **3. –ü—Ä–∏–Ω—Ü–∏–ø "–í—Å–µ–≥–¥–∞ –∏–º–µ–π—Ç–µ –ø–ª–∞–Ω –ë"**
- –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ì–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –æ—Ç–∫–∞—Ç—É –∏–∑–º–µ–Ω–µ–Ω–∏–π

### **4. –ü—Ä–∏–Ω—Ü–∏–ø "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞"**
- –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º

**–°–ª–µ–¥—É—è —ç—Ç–∏–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º, –≤—ã –∏–∑–±–µ–∂–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è —Å–∏—Ç—É–∞—Ü–∏–∏ —Å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º–∏ –ø–∞–¥–µ–Ω–∏—è–º–∏ —Å–∏—Å—Ç–µ–º—ã!**
